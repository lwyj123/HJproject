<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>layer弹层 - HJproject</title>
    <link rel="stylesheet" href="../src/css/layui.css">
</head>

<body>
    <script src="../src/js/lib/jquery.js"></script>
    <script src="../src/js/modules/HJalert.js"></script>
    <script src="../src/js/modules/HJtemplate.js"></script>
    <script src="../src/js/modules/HJtemplate.js"></script>
    <script src="../src/HJproject.js"></script>
    <script>
    var cssname = 'HJchat-default.css';

    HJproject.link(HJalert.cssPath, undefined, cssname, 'HJchat');



    var data = {
        name: '在线客服-小苍',
        type: 'kefu',
        avatar: 'http://tva3.sinaimg.cn/crop.0.0.180.180.180/7f5f6861jw1e8qgp5bmzyj2050050aa8.jpg',
        id: -1
    };
    var options = {

        //初始化接口
        init: {
            url: 'json/getList.json',
            data: {}
        }

        //或采用以下方式初始化接口
        /*
        ,init: {
          mine: {
            "username": "LayIM体验者" //我的昵称
            ,"id": "100000123" //我的ID
            ,"status": "online" //在线状态 online：在线、hide：隐身
            ,"remark": "在深邃的编码世界，做一枚轻盈的纸飞机" //我的签名
            ,"avatar": "a.jpg" //我的头像
          }
          ,friend: []
          ,group: []
        }
        */


        //查看群员接口
        ,
        members: {
            url: 'json/getMembers.json',
            data: {}
        }

        //上传图片接口
        ,
        uploadImage: {
            url: '/upload/image' //（返回的数据格式见下文）
                ,
            type: '' //默认post
        }

        //上传文件接口
        ,
        uploadFile: {
            url: '/upload/file' //（返回的数据格式见下文）
                ,
            type: '' //默认post
        }

        //扩展工具栏
        ,
        tool: [{
            alias: 'code',
            title: '代码',
            icon: '&#xe64e;'
        }]

        //,brief: true //是否简约模式（若开启则不显示主面板）

        //,title: 'WebIM' //自定义主面板最小化时的标题
        //,right: '100px' //主面板相对浏览器右侧距离
        //,minRight: '90px' //聊天面板最小化时相对浏览器右侧距离
        ,
        initSkin: '5.jpg' //1-5 设置初始背景
            //,skin: ['aaa.jpg'] //新增皮肤
            //,isfriend: false //是否开启好友
            //,isgroup: false //是否开启群组
            //,min: true //是否始终最小化主面板，默认false
            ,
        notice: true //是否开启桌面消息提醒，默认false
            //,voice: false //声音提醒，默认开启，声音文件为：default.wav

    };
    var obj = {
        base: options, //基础配置信息                                             
        friend: data.friend || [], //联系人信息             
    };
    var cache = {
        message: {},
        chat: []
    };
    cache = $.extend(cache, obj)


    var heredoc = function(fn) {
        return fn.toString().split('\n').slice(1,-1).join('\n') + '\n'
    }


    var elemChatTplFun = function() { /*
        <div style="display: block;" class="HJchat-chat HJchat-chat-{{d.data.type}}">
            <div class="HJproject-unselect HJchat-chat-title">
                <div class="HJchat-chat-other">
                    <span class="HJchat-chat-username">{{ d.data.name||"佚名" }} </span>
                    <p class="HJchat-chat-status"></p>
                </div>
            </div>
            <div class="HJchat-chat-main">
                <ul></ul>
            </div>
            <div class="HJchat-chat-footer">
                <div class="HJproject-unselect HJchat-chat-tool" data-json="{{encodeURIComponent(JSON.stringify(d.data))}}">
                </div>
                <div class="HJchat-chat-textarea">
                    <textarea></textarea>
                </div>
                <div class="HJchat-chat-bottom">
                    <div class="HJchat-chat-send">
                    {{# if(!d.base.brief){ }}
                        <span class="HJchat-send-close" HJchat-event="closeThisChat">关闭</span> 
                    {{# } }} 
                        <span class="HJchat-send-btn" HJchat-event="send">发送</span>
                    </div>
                </div> 
            </div>
        </div>
    */};



    //聊天主模板
    var elemChatTpl = heredoc(elemChatTplFun);

    //聊天内容列表模版
    var elemChatMain = ['<li {{ d.mine ? "class=HJchat-chat-mine" : "" }} {{# if(d.cid){ }}data-cid="{{d.cid}}"{{# } }}>', '<div class="HJchat-chat-user"><img src="{{ d.avatar }}"><cite>', '{{# if(d.mine){ }}', '<i>{{ HJproject.data.date(d.timestamp) }}</i>{{ d.username||"佚名" }}', '{{# } else { }}', '{{ d.username||"佚名" }}<i>{{ HJproject.data.date(d.timestamp) }}</i>', '{{# } }}', '</cite></div>', '<div class="HJchat-chat-text">{{ HJproject.data.content(d.content||"&nbsp") }}</div>', '</li>'].join('');






    var render = {
        data: data,
        base: '',
        local: ''
    };

    var index = chatIndex = HJalert.open({
        type: 1,
        area: '600px',
        id: 'HJproject-HJchat-chat',
        title: '&#8203;',
        shade: false,
        maxmin: true,
        content: HJtemplate.template('<div class="HJchat-chat-box">' + elemChatTpl + '</div>').render(render),
        success: function(layero) {
            HJchatChat = layero;

            layero.css({
                'min-width': '500px',
                'min-height': '420px'
            });

            typeof data.success === 'function' && data.success(layero);



            //查看大图
            layero.on('dblclick', '.HJproject-HJchat-photos', function() {
                var src = this.src;
                HJalert.close(popchat.photosIndex);
                HJalert.photos({
                    photos: {
                        data: [{
                            "alt": "大图模式",
                            "src": src
                        }]
                    },
                    shade: 0.01,
                    closeBtn: 2,
                    anim: 0,
                    resize: false,
                    success: function(layero, index) {
                        popchat.photosIndex = index;
                    }
                });
            });
        },
    });
    </script>
</body>

</html>
