<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>layer弹层 - layui</title>
    <link rel="stylesheet" href="../src/css/layui.css">
</head>

<body>
    <script src="../src/js/lib/jquery.js"></script>
    <script src="../src/js/modules/HJalert.js"></script>
    <script src="../src/js/modules/HJtemplate.js"></script>
    <script src="../src/HJproject.js"></script>
    <script>
    var cssname = 'HJchat-default.css';

    HJproject.link(HJalert.cssPath, undefined, cssname, 'HJchat');



    var data = {
        name: '在线客服-小苍',
        type: 'kefu',
        avatar: 'http://tva3.sinaimg.cn/crop.0.0.180.180.180/7f5f6861jw1e8qgp5bmzyj2050050aa8.jpg',
        id: -1
    };
    var options = {

        //初始化接口
        init: {
            url: 'json/getList.json',
            data: {}
        }

        //或采用以下方式初始化接口
        /*
        ,init: {
          mine: {
            "username": "LayIM体验者" //我的昵称
            ,"id": "100000123" //我的ID
            ,"status": "online" //在线状态 online：在线、hide：隐身
            ,"remark": "在深邃的编码世界，做一枚轻盈的纸飞机" //我的签名
            ,"avatar": "a.jpg" //我的头像
          }
          ,friend: []
          ,group: []
        }
        */


        //查看群员接口
        ,
        members: {
            url: 'json/getMembers.json',
            data: {}
        }

        //上传图片接口
        ,
        uploadImage: {
            url: '/upload/image' //（返回的数据格式见下文）
                ,
            type: '' //默认post
        }

        //上传文件接口
        ,
        uploadFile: {
            url: '/upload/file' //（返回的数据格式见下文）
                ,
            type: '' //默认post
        }

        //扩展工具栏
        ,
        tool: [{
            alias: 'code',
            title: '代码',
            icon: '&#xe64e;'
        }]

        //,brief: true //是否简约模式（若开启则不显示主面板）

        //,title: 'WebIM' //自定义主面板最小化时的标题
        //,right: '100px' //主面板相对浏览器右侧距离
        //,minRight: '90px' //聊天面板最小化时相对浏览器右侧距离
        ,
        initSkin: '5.jpg' //1-5 设置初始背景
            //,skin: ['aaa.jpg'] //新增皮肤
            //,isfriend: false //是否开启好友
            //,isgroup: false //是否开启群组
            //,min: true //是否始终最小化主面板，默认false
            ,
        notice: true //是否开启桌面消息提醒，默认false
            //,voice: false //声音提醒，默认开启，声音文件为：default.wav

    };
    var obj = {
        base: options, //基础配置信息                                             
        friend: data.friend || [], //联系人信息             
    };
    var cache = {
        message: {},
        chat: []
    };
    cache = $.extend(cache, obj)
        //换肤模版
    var elemSkinTpl = ['<ul class="layui-layim-skin">', '{{# layui.each(d.skin, function(index, item){ }}', '{{# }); }}', '</ul>'].join('');

    //聊天主模板
    var elemChatTpl = ['<div style="display: block;" class="layim-chat layim-chat-{{d.data.type}}">', '<div class="layui-unselect layim-chat-title">', '<div class="layim-chat-other">', '<span class="layim-chat-username">{{ d.data.name||"佚名" }} </span>', '<p class="layim-chat-status"></p>', '</div>', '</div>', '<div class="layim-chat-main">', '<ul></ul>', '</div>', '<div class="layim-chat-footer">', '<div class="layui-unselect layim-chat-tool" data-json="{{encodeURIComponent(JSON.stringify(d.data))}}">', '<span class="layui-icon layim-tool-face" title="选择表情" layim-event="face">&#xe60c;</span>', '{{# if(d.base && d.base.uploadImage){ }}', '<span class="layui-icon layim-tool-image" title="上传图片" layim-event="image">&#xe60d;<input type="file" name="file"></span>', '{{# layui.each(d.base.tool, function(index, item){ }}', '<span class="layui-icon layim-tool-{{item.alias}}" title="{{item.title}}" layim-event="extend" lay-filter="{{ item.alias }}">{{item.icon}}</span>', '{{# }); }}', '{{# }; }}', '</div>', '<div class="layim-chat-textarea"><textarea></textarea></div>', '<div class="layim-chat-bottom">', '<div class="layim-chat-send">', '{{# if(!d.base.brief){ }}', '<span class="layim-send-close" layim-event="closeThisChat">关闭</span>', '{{# } }}', '<span class="layim-send-btn" layim-event="send">发送</span>', '</div>', '</div>', '</div>', '</div>'].join('');

    //聊天内容列表模版
    var elemChatMain = ['<li {{ d.mine ? "class=layim-chat-mine" : "" }} {{# if(d.cid){ }}data-cid="{{d.cid}}"{{# } }}>', '<div class="layim-chat-user"><img src="{{ d.avatar }}"><cite>', '{{# if(d.mine){ }}', '<i>{{ layui.data.date(d.timestamp) }}</i>{{ d.username||"佚名" }}', '{{# } else { }}', '{{ d.username||"佚名" }}<i>{{ layui.data.date(d.timestamp) }}</i>', '{{# } }}', '</cite></div>', '<div class="layim-chat-text">{{ layui.data.content(d.content||"&nbsp") }}</div>', '</li>'].join('');

    var elemChatList = '<li class="layim-chatlist-{{ d.data.type }}{{ d.data.id }} layim-this" layim-event="tabChat"><img src="{{ d.data.avatar }}"><span>{{ d.data.name||"佚名" }}</span>{{# if(!d.base.brief){ }}<i class="layui-icon" layim-event="closeChat">&#x1007;</i>{{# } }}</li>';





    var render = {
        data: data,
        base: '',
        local: ''
    };

    var index = chatIndex = HJalert.open({
        type: 1,
        area: '600px',
        skin: 'layui-box layui-layim-chat',
        id: 'layui-layim-chat',
        title: '&#8203;',
        shade: false,
        maxmin: true,
        content: HJtemplate.template('<ul class="layui-unselect layim-chat-list">' + elemChatList + '</ul><div class="layim-chat-box">' + elemChatTpl + '</div>').render(render),
        success: function(layero) {
            layimChat = layero;

            layero.css({
                'min-width': '500px',
                'min-height': '420px'
            });

            typeof data.success === 'function' && data.success(layero);



            //查看大图
            layero.on('dblclick', '.layui-layim-photos', function() {
                var src = this.src;
                HJalert.close(popchat.photosIndex);
                HJalert.photos({
                    photos: {
                        data: [{
                            "alt": "大图模式",
                            "src": src
                        }]
                    },
                    shade: 0.01,
                    closeBtn: 2,
                    anim: 0,
                    resize: false,
                    success: function(layero, index) {
                        popchat.photosIndex = index;
                    }
                });
            });
        },
    });
    </script>
</body>

</html>
