<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>layer弹层 - layui</title>
    <link rel="stylesheet" href="../src/css/layui.css">
</head>

<body>
    <script src="../src/js/lib/jquery.js"></script>
    <script src="../src/js/modules/HJalert.js"></script>
    <script>
    var data = {
        name: '在线客服-小苍',
        type: 'kefu',
        avatar: 'http://tva3.sinaimg.cn/crop.0.0.180.180.180/7f5f6861jw1e8qgp5bmzyj2050050aa8.jpg',
        id: -1
    };
    var options = {

        //初始化接口
        init: {
            url: 'json/getList.json',
            data: {}
        }

        //或采用以下方式初始化接口
        /*
        ,init: {
          mine: {
            "username": "LayIM体验者" //我的昵称
            ,"id": "100000123" //我的ID
            ,"status": "online" //在线状态 online：在线、hide：隐身
            ,"remark": "在深邃的编码世界，做一枚轻盈的纸飞机" //我的签名
            ,"avatar": "a.jpg" //我的头像
          }
          ,friend: []
          ,group: []
        }
        */


        //查看群员接口
        ,
        members: {
            url: 'json/getMembers.json',
            data: {}
        }

        //上传图片接口
        ,
        uploadImage: {
            url: '/upload/image' //（返回的数据格式见下文）
                ,
            type: '' //默认post
        }

        //上传文件接口
        ,
        uploadFile: {
            url: '/upload/file' //（返回的数据格式见下文）
                ,
            type: '' //默认post
        }

        //扩展工具栏
        ,
        tool: [{
            alias: 'code',
            title: '代码',
            icon: '&#xe64e;'
        }]

        //,brief: true //是否简约模式（若开启则不显示主面板）

        //,title: 'WebIM' //自定义主面板最小化时的标题
        //,right: '100px' //主面板相对浏览器右侧距离
        //,minRight: '90px' //聊天面板最小化时相对浏览器右侧距离
        ,
        initSkin: '5.jpg' //1-5 设置初始背景
            //,skin: ['aaa.jpg'] //新增皮肤
            //,isfriend: false //是否开启好友
            //,isgroup: false //是否开启群组
            //,min: true //是否始终最小化主面板，默认false
            ,
        notice: true //是否开启桌面消息提醒，默认false
            //,voice: false //声音提醒，默认开启，声音文件为：default.wav

        ,
        msgbox: layui.cache.dir + 'css/modules/layim/html/msgbox.html' //消息盒子页面地址，若不开启，剔除该项即可
            ,
        find: layui.cache.dir + 'css/modules/layim/html/find.html' //发现页面地址，若不开启，剔除该项即可
            ,
        chatLog: layui.cache.dir + 'css/modules/layim/html/chatLog.html' //聊天记录页面地址，若不开启，剔除该项即可

    };
    var obj = {
        base: options, //基础配置信息                      
        local: local, //本地数据                     
        mine: mine, //我的用户信息          
        friend: data.friend || [], //联系人信息             
        history: local.history || {} //历史会话信息
    };
    var cache = {
        message: {},
        chat: []
    };
    cache = $.extend(cache, obj)
    
    var index = chatIndex = HJalert.open({
        type: 1,
        area: '600px',
        skin: 'layui-box layui-layim-chat',
        id: 'layui-layim-chat',
        title: '&#8203;',
        shade: false,
        maxmin: true,
        offset: data.offset || 'auto',
        anim: data.anim || 0,
        closeBtn: cache.base.brief ? false : 1,
        content: laytpl('<ul class="layui-unselect layim-chat-list">' + elemChatList + '</ul><div class="layim-chat-box">' + elemChatTpl + '</div>').render(render),
        success: function(layero) {
            layimChat = layero;

            layero.css({
                'min-width': '500px',
                'min-height': '420px'
            });

            typeof data.success === 'function' && data.success(layero);


            viewChatlog();
            showOffMessage();

            //聊天窗口的切换监听
            layui.each(call.chatChange, function(index, item) {
                item && item(thisChat());
            });

            //查看大图
            layero.on('dblclick', '.layui-layim-photos', function() {
                var src = this.src;
                layer.close(popchat.photosIndex);
                layer.photos({
                    photos: {
                        data: [{
                            "alt": "大图模式",
                            "src": src
                        }]
                    },
                    shade: 0.01,
                    closeBtn: 2,
                    anim: 0,
                    resize: false,
                    success: function(layero, index) {
                        popchat.photosIndex = index;
                    }
                });
            });
        },
        full: function(layero) {
            layer.style(index, {
                width: '100%',
                height: '100%'
            }, true);
        },
        min: function() {
            setChatMin();
            return false;
        },
        end: function() {
            layer.closeAll('tips');
            layimChat = null;
        }
    });
    </script>
</body>

</html>
